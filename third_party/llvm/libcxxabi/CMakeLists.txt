if (NOT ${TOS_ARCH} MATCHES arm AND
        NOT ${TOS_ARCH} MATCHES aarch64 AND
        NOT ${TOS_ARCH} MATCHES x86_64 AND
        NOT ${TOS_ARCH} MATCHES i386 AND
        NOT ${TOS_ARCH} MATCHES riscv)
    add_library(cxxabi_static INTERFACE)
    return()
endif()

set(LIBCXXABI_ENABLE_EXCEPTIONS OFF CACHE STRING "")
set(LIBCXXABI_ENABLE_ASSERTIONS OFF CACHE STRING "")
set(LIBCXXABI_ENABLE_PEDANTIC OFF CACHE STRING "")
set(LIBCXXABI_ENABLE_PIC OFF CACHE STRING "")
set(LIBCXXABI_USE_COMPILER_RT ON CACHE STRING "")
set(LIBCXXABI_ENABLE_NEW_DELETE_DEFINITIONS OFF CACHE STRING "")
set(LIBCXXABI_ENABLE_SHARED OFF CACHE STRING "")
set(LIBCXXABI_LIBCXX_PATH "${TOS_PROJECT_ROOT}/third_party/llvm/libcxx")
set(LIBCXXABI_ENABLE_RTTI ${ENABLE_RTTI} CACHE STRING "")
set(LIBCXXABI_BAREMETAL ON CACHE STRING "")

add_subdirectory(src)

target_link_libraries(cxxabi_static PUBLIC tos::libcxx)