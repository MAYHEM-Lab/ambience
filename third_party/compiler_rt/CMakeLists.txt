if (NOT ${TOS_ARCH} MATCHES arm AND
    NOT ${TOS_ARCH} MATCHES aarch64 AND
    NOT ${TOS_ARCH} MATCHES x86_64 AND
    NOT ${TOS_ARCH} MATCHES i386)
    return()
endif()

project(tos C CXX ASM)

set(COMPILER_RT_BUILD_BUILTINS ON CACHE STRING "")
set(COMPILER_RT_BAREMETAL_BUILD ON CACHE STRING "")
set(COMPILER_RT_DEFAULT_TARGET_ONLY ON CACHE STRING "")

set(COMPILER_RT_BUILD_SANITIZERS OFF CACHE STRING "")
set(COMPILER_RT_BUILD_XRAY OFF CACHE STRING "")
set(COMPILER_RT_BUILD_LIBFUZZER OFF CACHE STRING "")
set(COMPILER_RT_BUILD_PROFILE OFF CACHE STRING "")
set(COMPILER_RT_INCLUDE_TESTS OFF CACHE STRING "")
set(COMPILER_RT_BUILD_CRT OFF CACHE STRING "")

set(COMPILER_RT_OS_DIR "baremetal")

set(CMAKE_C_STANDARD_LIBRARIES picolibc)
set(CMAKE_CXX_STANDARD_LIBRARIES picolibc)

link_libraries(picolibc)
add_subdirectory(src)