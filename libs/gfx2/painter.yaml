$lidlmeta:
  name: tos::services
  imports:
    - ./gfx

# This enumeration represents the possible rotations of a display.
rotation:
  type: enumeration
  members:
    - vertical    # 0 degrees
    - horizontal  # 90 degrees counter clockwise

style:
  type: structure
  members:
    color: tos::gfx2.color

painter:
  type: service
  procedures:
    set_style:
      returns: ["i8"]
      parameters:
        s: style
    get_dimensions:
      returns:
        - tos::gfx2.size
      parameters: []
    draw_point:
      returns: ["i8"]
      parameters:
        p: tos::gfx2.point
    draw_line:
      returns:
        - i8
      parameters:
        l: tos::gfx2.line
    draw_rect:
      returns:
        - i8
      parameters:
        rect: tos::gfx2.rectangle
        radius: i8
        fill: bool
    draw_circle:
      returns:
        - i8
      parameters:
        center: tos::gfx2.point
        radius: i8
        fill: bool
    draw_text:
      returns:
        - i8
      parameters:
        text: string_view
        p: tos::gfx2.point
    draw_bitmap:
      returns:
        - bool
      parameters:
        color_type: tos::gfx2.colors
        buffer:
          name: span
          parameters:
            - u8
        stride: i16
        image_rect: tos::gfx2.rectangle
        screen_rect: tos::gfx2.rectangle
    # Flushes any buffers within the painter. Before calling this function, the contents of the output of this painter
    # may be incomplete.
    flush:
      returns:
        - i8
      parameters: []
    # Sets the orientation of the painter.
    # This causes future coordinates to be translated to the physical coordinates. For instance, coordinate (3, 4) will
    # correspond to (w - 3, 4) when rotated 90 degrees.
    set_orientation:
      returns:
        - bool
      parameters:
        orientation: rotation